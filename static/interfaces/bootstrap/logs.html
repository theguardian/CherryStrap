<%inherit file="base.html"/>
<%!
	import cherrystrap
%>

<%def name="headIncludes()">
<link rel="stylesheet" href="//cdn.datatables.net/1.10.10/css/jquery.dataTables.min.css"/>
<title>${cherrystrap.APP_NAME}: ${title}</title>
</%def>

<%def name="body()">
<h1>Log Viewer</h1>
	<div class="row col-md-12 logTable">
		<table class="table table-striped" id="log_table">
			<thead>
				<tr>
					<th id="timestamp">Timestamp</th>
					<th id="level">Level</th>
					<th id="thread">Thread</th>
					<th id="message">Message</th>
				</tr>
			</thead>
		</table>
	</div>

	<div class="row col-md-12">
		<div class="col-md-4 col-md-offset-4 input-group">
			<div class="input-group-addon">Refresh Rate:&nbsp;</div>
			<select name="refresh_rate" class="form-control" id="refreshrate" onchange="setRefresh()">
				<option value="0" selected="selected">Disabled</option>
				<option value="5">5</option>
				<option value="15">15</option>
				<option value="30">30</option>
				<option value="60">60</option>
				<option value="300">300</option>
				<option value="600">600</option>
			</select>
			<div class="input-group-addon">Seconds</div>
		</div>
	</div>
</%def>

<%def name="javascriptIncludes()">
	<script src="js/jquery.dataTables.min.js"></script>
	<script>
		$(document).ready(function() {
			var dataTable = $('#log_table').dataTable({
				serverSide: true,
				ajax: {
					url: '/api/v1/getLog',
					type: 'get',
				},
				order: [[ 0, 'desc' ]]
			});
		});

		var timer;
		function setRefresh()
		{
			refreshrate = document.getElementById('refreshrate');
			if(refreshrate != null)
			{
				if(timer)
				{
					clearInterval(timer);
				}
				if(refreshrate.value != 0)
				{
					timer = setInterval("$('#log_table').dataTable().fnDraw()",1000*refreshrate.value);
				}
			}
		}
	</script>
</%def>
